## 单线程

- 在Java 、PHP 或者 .net 等服务器端语言中，会为每一个客户端连接创建一个新的进程。而每个进程需要耗费大约 2M 内存。也就说，理论上一个8G内存的服务器可以同时连接的最大用户数为4000个左右。要让web应用程序同时支持更多的用户，就需要增加服务器的数量或增加服务器的内存数，而web应用程序的硬件成本当然就上升了。

- Node.js 不为每个客户连接创建一个新的线程，而仅仅使用一个线程（thread）。当有用户连接了，就触发一个内部事件，通过非阻塞I/O、事件驱动机制，让 Node.js 程序宏观上也是并行的。**使用 Node.js，一个8GB内存的服务器，可以同时处理超过4万用户的连接。**

- 另外，单线程带来的好处，还有操作系统完全不再有线程创建、销毁的时间开销。

- 多线程程序，CPU经常会等待I/O结束，CPU的性能白白消耗

- 单线程的程序，当并行极大的时候，CPU理论上计算能力是100%

### 单线程带来的问题

- 无法利用多核CPU
- 错误会引发整个应用的退出，应用的健壮性值得考验
- 大量计算会占用CPU导致无法继续调用异步I/O

### 解决方案

- H5的 Web Workers 能够创建工作进程来进行计算，以解决 JavaScript 大计算阻塞 UI 渲染的问题。工作线程为了不阻塞主线程，通过消息传递的方式来传递运行结果，这也使得工作线程不能访问到主进程的UI
- Node 采用了与 Web Workers 相同的思路来解决单线程中大计算量的问题：child_process
- 子进程的出现，意味着Node可以从容地应对单线程在健壮性和无法利用多核CPU方面的问题。通过将计算分发到各子进程中，可以将大量计算分解掉，然后再通过进程之间的事件消息来传递结果，这可以很好地保持应用模型的简单和依赖性。通过 Master-Worker 的管理方式，也可以很好地管理各个工作进程，已到达更高的健壮性